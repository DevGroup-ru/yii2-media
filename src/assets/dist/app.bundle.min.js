!function(e){function t(a){if(i[a])return i[a].exports;var s=i[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var i={};t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,a){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=2)}([function(e,t,i){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),n=function(){function e(t){var i=this;a(this,e),this.$input=t,this.$object=t.closest(".media-attachment"),this.settings={dragOverClass:"media-attachment__selected-files_drag_over",isUploadingClass:"media-attachment__selected-files_is_uploading",isSuccessClass:"media-attachment__selected-files_is_success",isErrorClass:"media-attachment__selected-files_is_error"},this.fs={uploadTarget:this.$input.data("fsUploadTarget"),listFiles:this.$input.data("fsListFiles"),listFolders:this.$input.data("fsListFolders"),trees:this.$input.data("fsTrees"),getFiles:this.$input.data("fsGetFiles")},this.model=this.$input.data("model"),this.modelId=this.$input.data("modelId"),this.relationName=this.$input.data("relationName"),this.csrfParam=this.$input.data("csrfParam"),this.csrfToken=this.$input.data("csrfToken"),this.$galleryContainer=this.$object.find(".media-attachment__gallery-container"),this.$browseGallery=this.$object.find(".media-attachment__browse"),this.$browseGallery.click(function(){return i.$galleryContainer.toggleClass("media-attachment__gallery-container_active"),!1}),this.$uploadButton=this.$object.find(".media-attachment__upload"),this.$fakeInput=$('<input type="file" multiple>').attr("name","UploadModel[files][]"),this.$uploadButton.click(function(){return i.$fakeInput.click(),!1}),this.$selectedFiles=this.$object.find(".media-attachment__selected-files");var s=this;this.$selectedFiles.on("click",".media-attachment__file-delete",function(){return s.removeFile($(this).closest(".media-attachment__file")),!1}),this.droppedFiles=!1,this.bindUpload(),this.$selectedFiles.sortable({handle:".media-attachment__file-thumb",items:".media-attachment__file",forcePlaceholderSize:!0,placeholder:"media-attachment__file",opacity:.5,update:function(){return i.$input.val(i.$selectedFiles.sortable("toArray",{attribute:"data-id"}).join(","))}}),this.refreshFiles()}return s(e,[{key:"bindUpload",value:function(){var e=this;this.$selectedFiles.on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.originalEvent.dataTransfer.files&&(e.preventDefault(),e.stopPropagation())}).on("dragover dragenter",function(){e.$selectedFiles.addClass(e.settings.dragOverClass)}).on("dragleave dragend drop",function(){e.$selectedFiles.removeClass(e.settings.dragOverClass)}).on("drop",function(t){e.droppedFiles=t.originalEvent.dataTransfer.files,e.submit()}),this.$fakeInput.change(function(){e.droppedFiles=e.$fakeInput[0].files,e.submit()})}},{key:"submit",value:function(){var e=this;this.$selectedFiles.addClass(this.settings.isUploadingClass);var t=new window.FormData;$.each(this.droppedFiles,function(e,i){t.append("UploadModel[files][]",i)}),t.append(this.csrfParam,this.csrfToken),t.append("UploadModel[model]",this.model),t.append("UploadModel[model_id]",this.modelId),t.append("UploadModel[relation_name]",this.relationName),$.ajax({url:this.fs.uploadTarget,method:"POST",data:t,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){e.$selectedFiles.removeClass(e.settings.isUploadingClass),e.droppedFiles=!1},success:function(t){if(e.$selectedFiles.addClass(t.success===!0?e.settings.isSuccessClass:e.settings.isErrorClass),t.success){var i=e.$input.val();""!==i&&(i+=","),i+=t.ids,i=i.split(",").filter(function(e,t,i){return i.indexOf(e)===t}).join(","),e.$input.val(i),e.refreshFiles()}else;}})}},{key:"refreshFiles",value:function(){var t=this,i=this.$input.val();if(""!==i){this.$selectedFiles.addClass(this.settings.isUploadingClass);var a={ids:i};a[this.csrfParam]=this.csrfToken,$.ajax({url:this.fs.getFiles,data:a,method:"POST",cache:!1,complete:function(){t.$selectedFiles.removeClass(t.settings.isUploadingClass)},success:function(a){t.$selectedFiles.empty();var s=i.split(","),n=[];s.forEach(function(t){a[t]&&n.push(e.$file(a[t]))}),t.$selectedFiles.append(n)}})}}},{key:"removeFile",value:function(e){var t=e.data("id"),i=this.$input.val().split(",");i.splice(i.indexOf(""+t),1),this.$input.val(i.join(",")),e.remove()}}],[{key:"$file",value:function(e){var t="";return e.imageData&&e.imageData.thumb&&(t='<img src="'+e.imageData.thumb.fileData.public_url+'">'),$('\n<div class="media-attachment__file" data-id="'+e.id+'">\n    <div class="media-attachment__file-thumb">\n        '+t+'\n    </div>\n    <div class="media-attachment__file-name">\n        '+e.name+'        \n    </div>\n    <a href="#" class="media-attachment__file-delete">\n        <i class="fa fa-trash-o fa-fw"></i>    \n    </a>\n</div>\n')}},{key:"bindToInput",value:function(t){return new e(t instanceof $?t:$("#"+t))}}]),e}();t.default=n},function(e,t){},function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}i(1);var s=i(0),n=a(s);window.MediaAttachment=n.default}]);