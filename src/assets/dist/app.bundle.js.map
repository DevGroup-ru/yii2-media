{"version":3,"sources":["webpack:///webpack/bootstrap 1487e987ce1801057945","webpack:///./src/Attachment.js","webpack:///./src/app.scss","webpack:///./src/index.js"],"names":["Attachment","$input","$object","closest","settings","dragOverClass","isUploadingClass","isSuccessClass","isErrorClass","fs","uploadTarget","data","listFiles","listFolders","trees","getFiles","model","modelId","relationName","csrfParam","csrfToken","$galleryContainer","find","$browseGallery","click","toggleClass","$uploadButton","$fakeInput","$","attr","$selectedFiles","that","on","removeFile","droppedFiles","bindUpload","sortable","handle","items","forcePlaceholderSize","placeholder","opacity","update","val","attribute","join","refreshFiles","e","originalEvent","dataTransfer","files","preventDefault","stopPropagation","addClass","removeClass","submit","change","formData","window","FormData","each","i","file","append","ajax","url","method","dataType","cache","contentType","processData","complete","success","values","ids","split","filter","onlyUnique","value","index","self","indexOf","empty","orderedIds","allFiles","forEach","id","push","$file","vals","splice","remove","decl","thumb","imageData","fileData","public_url","name","input","MediaAttachment"],"mappings":"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","file":"app.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 1487e987ce1801057945","class Attachment {\n  constructor($input) {\n    this.$input = $input;\n    this.$object = $input.closest('.media-attachment');\n\n    this.settings = {\n      dragOverClass: 'media-attachment__selected-files_drag_over',\n      isUploadingClass: 'media-attachment__selected-files_is_uploading',\n      isSuccessClass: 'media-attachment__selected-files_is_success',\n      isErrorClass: 'media-attachment__selected-files_is_error'\n    };\n\n    this.fs = {\n      uploadTarget: this.$input.data('fsUploadTarget'),\n      listFiles: this.$input.data('fsListFiles'),\n      listFolders: this.$input.data('fsListFolders'),\n      trees: this.$input.data('fsTrees'),\n      getFiles: this.$input.data('fsGetFiles')\n    };\n\n    this.model = this.$input.data('model');\n    this.modelId = this.$input.data('modelId');\n    this.relationName = this.$input.data('relationName');\n\n    this.csrfParam = this.$input.data('csrfParam');\n    this.csrfToken = this.$input.data('csrfToken');\n\n    this.$galleryContainer = this.$object.find('.media-attachment__gallery-container');\n\n    this.$browseGallery = this.$object.find('.media-attachment__browse');\n    this.$browseGallery.click(() => {\n      this.$galleryContainer.toggleClass('media-attachment__gallery-container_active');\n      return false;\n    });\n\n    this.$uploadButton = this.$object.find('.media-attachment__upload');\n\n    this.$fakeInput = $('<input type=\"file\" multiple>')\n      .attr('name', 'UploadModel[files][]');\n\n    this.$uploadButton.click(() => {\n      this.$fakeInput.click();\n      return false;\n    });\n\n\n    this.$selectedFiles = this.$object.find('.media-attachment__selected-files');\n    const that = this;\n    this.$selectedFiles.on('click', '.media-attachment__file-delete', function() {\n      that.removeFile($(this).closest('.media-attachment__file'));\n      return false;\n    });\n\n    this.droppedFiles = false;\n\n    this.bindUpload();\n\n    this.$selectedFiles.sortable({\n      handle: '.media-attachment__file-thumb',\n      items: '.media-attachment__file',\n      forcePlaceholderSize: true,\n      placeholder: 'media-attachment__file',\n      opacity: 0.5,\n      update: () =>\n        this.$input.val(\n          this.$selectedFiles\n            .sortable(\n              'toArray',\n              {attribute: 'data-id'}\n            ).join(',')\n        )\n    });\n\n    this.refreshFiles();\n  }\n\n  bindUpload() {\n    this.$selectedFiles\n      .on('drag dragstart dragend dragover dragenter dragleave drop', function (e) {\n        // preventing the unwanted behaviours\n        if (e.originalEvent.dataTransfer.files) {\n          e.preventDefault();\n          e.stopPropagation();\n        }\n      })\n      .on('dragover dragenter', () => {\n        this.$selectedFiles.addClass(this.settings.dragOverClass);\n      })\n      .on('dragleave dragend drop', () => {\n        this.$selectedFiles.removeClass(this.settings.dragOverClass);\n      })\n      .on('drop', (e) => {\n        this.droppedFiles = e.originalEvent.dataTransfer.files; // the files that were dropped\n        // trigger submit\n        this.submit();\n      });\n    this.$fakeInput.change(() => {\n      this.droppedFiles = this.$fakeInput[0].files;\n      this.submit();\n    });\n  }\n\n  submit() {\n    this.$selectedFiles.addClass(this.settings.isUploadingClass);\n    const formData = new window.FormData();\n    $.each(this.droppedFiles, function(i, file) {\n      formData.append('UploadModel[files][]', file);\n    });\n    formData.append(this.csrfParam, this.csrfToken);\n    formData.append('UploadModel[model]', this.model);\n    formData.append('UploadModel[model_id]', this.modelId);\n    formData.append('UploadModel[relation_name]', this.relationName);\n\n    $.ajax({\n      url: this.fs.uploadTarget,\n      method: 'POST',\n      data: formData,\n      dataType: 'json',\n      cache: false,\n      contentType: false,\n      processData: false,\n      complete: () => {\n        this.$selectedFiles.removeClass(this.settings.isUploadingClass);\n        this.droppedFiles = false;\n      },\n      success: (data) => {\n        this.$selectedFiles\n          .addClass(data.success === true ? this.settings.isSuccessClass : this.settings.isErrorClass);\n        if (!data.success) {\n          // $errorMsg.text(data.error);\n        } else {\n          let values = this.$input.val();\n          if (values !== '') {\n            values += ',';\n          }\n          values += data.ids;\n          values = values.split(',').filter(function onlyUnique(value, index, self) {\n            return self.indexOf(value) === index;\n          }).join(',');\n          this.$input.val(values);\n\n          this.refreshFiles();\n        }\n      }\n    });\n  }\n\n  refreshFiles() {\n    const ids = this.$input.val();\n    if (ids === '') {\n      return;\n    }\n\n    this.$selectedFiles.addClass(this.settings.isUploadingClass);\n    const data = {ids};\n    data[this.csrfParam] = this.csrfToken;\n    $.ajax({\n      url: this.fs.getFiles,\n      data,\n      method: 'POST',\n      cache: false,\n      complete: () => {\n        this.$selectedFiles.removeClass(this.settings.isUploadingClass);\n      },\n      success: (data) => {\n        this.$selectedFiles.empty();\n        const orderedIds = ids.split(',');\n        const allFiles = [];\n\n        orderedIds.forEach((id) => {\n          if (data[id]) {\n            allFiles.push(Attachment.$file(data[id]));\n          }\n        });\n\n        this.$selectedFiles.append(allFiles);\n      }\n    });\n  }\n\n  static $file(decl) {\n    let thumb = '';\n    if (decl.imageData) {\n      if (decl.imageData.thumb) {\n        thumb = `<img src=\"${decl.imageData.thumb.fileData.public_url}\">`;\n      }\n    }\n\n    return $(`\n<div class=\"media-attachment__file\" data-id=\"${decl.id}\">\n    <div class=\"media-attachment__file-thumb\">\n        ${thumb}\n    </div>\n    <div class=\"media-attachment__file-name\">\n        ${decl.name}        \n    </div>\n    <a href=\"#\" class=\"media-attachment__file-delete\">\n        <i class=\"fa fa-trash-o fa-fw\"></i>    \n    </a>\n</div>\n`);\n  }\n\n  removeFile($file) {\n    const id = $file.data('id');\n    const vals = this.$input.val().split(',');\n    vals.splice(vals.indexOf(`${id}`), 1);\n    this.$input.val(vals.join(','));\n    $file.remove();\n  }\n\n  static bindToInput(input) {\n    const $input = input instanceof $ ? input : $(`#${input}`);\n\n    return new Attachment($input);\n  }\n}\n\nexport default Attachment;\n\n\n// WEBPACK FOOTER //\n// ./src/Attachment.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app.scss\n// module id = 1\n// module chunks = 0","import './app.scss';\n\nimport Attachment from './Attachment';\n\nwindow.MediaAttachment = Attachment;\n\n\n// WEBPACK FOOTER //\n// ./src/index.js"],"sourceRoot":""}